define("videotimeplugin_repository/mod_form",["jquery","core/modal_factory","videotimeplugin_repository/modal_video_list","core/str","core/ajax"],(function($,ModalFactory,ModalVideoList,str,Ajax){return{init:function(isTotara,contextId){var trigger=$("#id_choose_video"),requiredstrings=[];requiredstrings.push({key:"choose_video",component:"videotime"}),requiredstrings.push({key:"pull_from_vimeo_loading",component:"videotime"}),requiredstrings.push({key:"pull_from_vimeo_invalid_videoid",component:"videotime"}),requiredstrings.push({key:"pull_from_vimeo_success",component:"videotime"}),str.get_strings(requiredstrings).done(function(strings){Ajax.call([{methodname:"videotimeplugin_repository_get_filter_options",args:{}}])[0].then((function(response){response.is_totara=isTotara,ModalFactory.create({type:ModalVideoList.TYPE,title:strings[0],templateContext:response},trigger,response).done((function(modal){modal.setContextId(contextId),modal.setReadOnly(!1),modal.init(),modal.refreshTable()}))})),$("#id_pull_from_vimeo").on("click",(function(e){var originalLabel=$(e.target).val();$(e.target).attr("value",strings[1]),$(e.target).prop("disabled",!0);var videoId=$("#id_vimeo_url").val().split("/")[3];if(isNaN(videoId))return alert(strings[2]),$(e.target).attr("value",originalLabel),void $(e.target).prop("disabled",!1);Ajax.call([{methodname:"videotimeplugin_repository_api_request",args:{url:"/videos/"+videoId,contextid:contextId}}])[0].done(function(response){var apiResponse=JSON.parse(response.data);if(200!=apiResponse.status)return alert("API error: "+apiResponse.body.error),$(e.target).attr("value",originalLabel),void $(e.target).prop("disabled",!1);var video=apiResponse.body;alert(strings[3]),$("#id_name").val(video.name),$("#id_introeditor").val(video.description),$("#id_introeditoreditable").html(video.description),$("#id_completion_on_view_time_second").val(video.duration),$("#fitem_id_tags .form-autocomplete-selection").empty(),$("#fitem_id_tags #id_tags").empty(),$.each(video.tags,(function(index,tag){$("#fitem_id_tags #id_tags").append('<option data-iscustom="true" value="'+tag.name+'" selected>'+tag.name+"</option>"),$("#fitem_id_tags .form-autocomplete-selection").append('<span role="listitem" data-value="'+tag.name+'" aria-selected="true" class="label label-info"><span aria-hidden="true">Ã— </span>'+tag.name+"</span>")})),$(e.target).attr("value",originalLabel),$(e.target).prop("disabled",!1)}.bind(this))}))}.bind(this))}}}));

//# sourceMappingURL=mod_form.min.js.map