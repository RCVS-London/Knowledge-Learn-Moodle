{"version":3,"file":"mod_form.min.js","sources":["../src/mod_form.js"],"sourcesContent":["define([\n    'jquery',\n    'core/modal_factory',\n    'videotimeplugin_repository/modal_video_list',\n    'core/str',\n    'core/ajax'\n], function(\n    $,\n    ModalFactory,\n    ModalVideoList,\n    str,\n    Ajax\n) {\n\n    var init = function(isTotara, contextId) {\n        var trigger = $('#id_choose_video');\n\n        var requiredstrings = [];\n        requiredstrings.push({key: 'choose_video', component: 'videotime'});\n        requiredstrings.push({key: 'pull_from_vimeo_loading', component: 'videotime'});\n        requiredstrings.push({key: 'pull_from_vimeo_invalid_videoid', component: 'videotime'});\n        requiredstrings.push({key: 'pull_from_vimeo_success', component: 'videotime'});\n\n        str.get_strings(requiredstrings).done(function(strings) {\n            Ajax.call([{\n                methodname: 'videotimeplugin_repository_get_filter_options',\n                args: {}\n            }])[0].then(function(response) {\n                response.is_totara = isTotara;\n                ModalFactory.create({\n                    type: ModalVideoList.TYPE,\n                    title: strings[0],\n                    templateContext: response // Moodle template context.\n                }, trigger, response).done(function (modal) { // Totara template context.\n                    modal.setContextId(contextId);\n                    modal.setReadOnly(false);\n                    modal.init();\n                    modal.refreshTable();\n                });\n            });\n\n            $(\"#id_pull_from_vimeo\").on('click', function(e) {\n                var originalLabel = $(e.target).val();\n                $(e.target).attr('value', strings[1]);\n                $(e.target).prop('disabled', true);\n\n                var link = $(\"#id_vimeo_url\").val();\n                var videoId = link.split('/')[3];\n\n                if (isNaN(videoId)) {\n                    alert(strings[2]);\n                    $(e.target).attr('value', originalLabel);\n                    $(e.target).prop('disabled', false);\n                    return;\n                }\n\n                var promises = Ajax.call([\n                    {\n                        methodname: 'videotimeplugin_repository_api_request', args: {\n                            'url': '/videos/' + videoId,\n                            'contextid': contextId\n                        }\n                    }\n                ]);\n\n                promises[0].done(function(response) {\n                    var apiResponse = JSON.parse(response.data);\n                    if (apiResponse.status != 200) {\n                        alert('API error: ' + apiResponse.body.error);\n                        $(e.target).attr('value', originalLabel);\n                        $(e.target).prop('disabled', false);\n                        return;\n                    }\n\n                    var video = apiResponse.body;\n\n                    alert(strings[3]);\n\n                    $('#id_name').val(video.name);\n                    $('#id_introeditor').val(video.description);\n                    $('#id_introeditoreditable').html(video.description);\n                    $('#id_completion_on_view_time_second').val(video.duration);\n\n                    // Add tags\n                    // First remove any selections.\n                    $(\"#fitem_id_tags .form-autocomplete-selection\").empty();\n                    $(\"#fitem_id_tags #id_tags\").empty();\n                    $.each(video.tags, function(index, tag) {\n                        $(\"#fitem_id_tags #id_tags\").append('<option data-iscustom=\"true\" value=\"' + tag.name +\n                            '\" selected>' + tag.name + '</option>');\n                        $(\"#fitem_id_tags .form-autocomplete-selection\").append('<span role=\"listitem\" data-value=\"' +\n                            tag.name + '\" aria-selected=\"true\" class=\"label label-info\"><span aria-hidden=\"true\">Ã— </span>' +\n                            tag.name + '</span>');\n                    });\n\n                    $(e.target).attr('value', originalLabel);\n                    $(e.target).prop('disabled', false);\n                }.bind(this));\n            });\n        }.bind(this));\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","ModalFactory","ModalVideoList","str","Ajax","init","isTotara","contextId","trigger","requiredstrings","push","key","component","get_strings","done","strings","call","methodname","args","then","response","is_totara","create","type","TYPE","title","templateContext","modal","setContextId","setReadOnly","refreshTable","on","e","originalLabel","target","val","attr","prop","videoId","split","isNaN","alert","apiResponse","JSON","parse","data","status","body","error","video","name","description","html","duration","empty","each","tags","index","tag","append","bind","this"],"mappings":"AAAAA,6CAAO,CACH,SACA,qBACA,8CACA,WACA,cACD,SACCC,EACAC,aACAC,eACAC,IACAC,YA2FO,CACHC,KAzFO,SAASC,SAAUC,eACtBC,QAAUR,EAAE,oBAEZS,gBAAkB,GACtBA,gBAAgBC,KAAK,CAACC,IAAK,eAAgBC,UAAW,cACtDH,gBAAgBC,KAAK,CAACC,IAAK,0BAA2BC,UAAW,cACjEH,gBAAgBC,KAAK,CAACC,IAAK,kCAAmCC,UAAW,cACzEH,gBAAgBC,KAAK,CAACC,IAAK,0BAA2BC,UAAW,cAEjET,IAAIU,YAAYJ,iBAAiBK,KAAK,SAASC,SAC3CX,KAAKY,KAAK,CAAC,CACPC,WAAY,gDACZC,KAAM,MACN,GAAGC,MAAK,SAASC,UACjBA,SAASC,UAAYf,SACrBL,aAAaqB,OAAO,CAChBC,KAAMrB,eAAesB,KACrBC,MAAOV,QAAQ,GACfW,gBAAiBN,UAClBZ,QAASY,UAAUN,MAAK,SAAUa,OACjCA,MAAMC,aAAarB,WACnBoB,MAAME,aAAY,GAClBF,MAAMtB,OACNsB,MAAMG,qBAId9B,EAAE,uBAAuB+B,GAAG,SAAS,SAASC,OACtCC,cAAgBjC,EAAEgC,EAAEE,QAAQC,MAChCnC,EAAEgC,EAAEE,QAAQE,KAAK,QAASrB,QAAQ,IAClCf,EAAEgC,EAAEE,QAAQG,KAAK,YAAY,OAGzBC,QADOtC,EAAE,iBAAiBmC,MACXI,MAAM,KAAK,MAE1BC,MAAMF,gBACNG,MAAM1B,QAAQ,IACdf,EAAEgC,EAAEE,QAAQE,KAAK,QAASH,oBAC1BjC,EAAEgC,EAAEE,QAAQG,KAAK,YAAY,GAIlBjC,KAAKY,KAAK,CACrB,CACIC,WAAY,yCAA0CC,KAAM,KACjD,WAAaoB,kBACP/B,cAKhB,GAAGO,KAAK,SAASM,cAClBsB,YAAcC,KAAKC,MAAMxB,SAASyB,SACZ,KAAtBH,YAAYI,cACZL,MAAM,cAAgBC,YAAYK,KAAKC,OACvChD,EAAEgC,EAAEE,QAAQE,KAAK,QAASH,oBAC1BjC,EAAEgC,EAAEE,QAAQG,KAAK,YAAY,OAI7BY,MAAQP,YAAYK,KAExBN,MAAM1B,QAAQ,IAEdf,EAAE,YAAYmC,IAAIc,MAAMC,MACxBlD,EAAE,mBAAmBmC,IAAIc,MAAME,aAC/BnD,EAAE,2BAA2BoD,KAAKH,MAAME,aACxCnD,EAAE,sCAAsCmC,IAAIc,MAAMI,UAIlDrD,EAAE,+CAA+CsD,QACjDtD,EAAE,2BAA2BsD,QAC7BtD,EAAEuD,KAAKN,MAAMO,MAAM,SAASC,MAAOC,KAC/B1D,EAAE,2BAA2B2D,OAAO,uCAAyCD,IAAIR,KAC7E,cAAgBQ,IAAIR,KAAO,aAC/BlD,EAAE,+CAA+C2D,OAAO,qCACpDD,IAAIR,KAAO,qFACXQ,IAAIR,KAAO,cAGnBlD,EAAEgC,EAAEE,QAAQE,KAAK,QAASH,eAC1BjC,EAAEgC,EAAEE,QAAQG,KAAK,YAAY,IAC/BuB,KAAKC,WAEbD,KAAKC"}